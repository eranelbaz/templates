version: 2
deploy:
  steps:
    terraformInit:
      before:
        - name: Backup lock file if it exists
          run: |
            if [ -f .terraform.lock.hcl ]; then
              cp .terraform.lock.hcl .terraform.lock.hcl_bk
            else
              touch .terraform.lock.hcl_bk  # Create an empty backup file if the lock file doesn't exist
            fi
      after:
        - name: Check lock file changes
          run: |
            if [ -f .terraform.lock.hcl_bk ] && [ -f .terraform.lock.hcl ]; then
              diff_output=$(diff .terraform.lock.hcl .terraform.lock.hcl_bk)
              if [ $? -ne 0 ]; then
                echo "Lock file has changed:"
                echo "$diff_output"
              else
                echo "No changes in the lock file."
              fi
            else
              echo "No lock file to compare."
            fi
