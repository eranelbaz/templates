version: 2  
deploy:
  steps:
    terraformInit:
      before:
        - name: Remove Assume Role
          run: |
            #!/bin/bash
            PROVIDER_FILE="provider.tf"
            cat provider.tf
            # Remove assume_role block (handles spacing & multi-line removal)
            awk '
            /assume_role {/ { in_block=1; next }
            /}/ { if (in_block) { in_block=0; next } }
            !in_block { print }
            ' "$PROVIDER_FILE" > temp.tf && mv temp.tf "$PROVIDER_FILE"
            
            echo "Removed assume_role block from $PROVIDER_FILE"
            echo "Removed assume_role block from $PROVIDER_FILE"
            cat provider.tf
