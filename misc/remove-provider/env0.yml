version: 2  
deploy:
  steps:
    terraformInit:
      before:
        - name: Remove Assume Role
          run: |
            #!/bin/bash
            PROVIDER_FILE="provider.tf"

            # Use awk to properly remove assume_role block including all its contents
            awk '
            /assume_role[[:space:]]*\{/ { in_block=1; next }  # Match "assume_role {", handling spaces
            in_block && /^\s*\}/ { in_block=0; next }         # Match closing "}"
            !in_block { print }                              # Print all lines outside the block
            ' "$PROVIDER_FILE" > temp.tf && mv temp.tf "$PROVIDER_FILE"

            echo "Removed assume_role block from $PROVIDER_FILE"

            # Print final file for debugging
            cat "$PROVIDER_FILE"
